"use strict";(self.webpackChunkcourses=self.webpackChunkcourses||[]).push([[9707],{1338:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/appinventor-1975b158da5d0d03b8fc322ad774e823.png"},3497:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ultrasonic-604dfa518ecaa2787bd1588aaef79bf8.webp"},7055:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"iot/lesson4","title":"Radar App","description":"-----------------","source":"@site/docs/iot/lesson4.md","sourceDirName":"iot","slug":"/iot/lesson4","permalink":"/docs/iot/lesson4","draft":false,"unlisted":false,"editUrl":"https://github.com/ipworkshop/ipworkshop.github.io/edit/main/docs/iot/lesson4.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Radar App","slug":"lesson4","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"WiFi","permalink":"/docs/iot/lesson3"},"next":{"title":"Overview","permalink":"/docs/category/overview"}}');var l=s(4848),r=s(8453);const c={title:"Radar App",slug:"lesson4",sidebar_position:5},o=void 0,d={},t=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Wiring",id:"wiring",level:2},{value:"Part 1 - Pico W Firmware (HTTP API)",id:"part-1---pico-w-firmware-http-api",level:2},{value:"1.1 Servo helper",id:"11-servo-helper",level:3},{value:"1.2 Ultrasonic distance helper",id:"12-ultrasonic-distance-helper",level:3},{value:"1.3 HTTP server",id:"13-http-server",level:3},{value:"Part 2 - Build the MIT App Inventor App",id:"part-2---build-the-mit-app-inventor-app",level:2},{value:"2.1 Designer (UI components)",id:"21-designer-ui-components",level:3},{value:"2.2 Blocks - Configuration",id:"22-blocks---configuration",level:3},{value:"2.3 Blocks - Set angle",id:"23-blocks---set-angle",level:3},{value:"2.4 Blocks - Poll distance (Clock)",id:"24-blocks---poll-distance-clock",level:3},{value:"2.5 Blocks - Handle responses",id:"25-blocks---handle-responses",level:3},{value:"2.6 Drawing on Canvas (simple chart)",id:"26-drawing-on-canvas-simple-chart",level:3},{value:"Part 3 - Try It",id:"part-3---try-it",level:2},{value:"Exercise",id:"exercise",level:2},{value:"Optional: Using Flask as a Relay (Bonus)",id:"optional-using-flask-as-a-relay-bonus",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Raspberry Pi ",(0,l.jsx)(n.strong,{children:"Pico W"})," with MicroPython"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"Servo"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Ultrasonic"})," distance sensor"]}),"\n",(0,l.jsx)(n.li,{children:"Android phone (App Inventor Companion app installed)"}),"\n",(0,l.jsx)(n.li,{children:"Basic familiarity with the previous Wi-Fi lesson (connecting Pico W & HTTP)"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"wiring",children:"Wiring"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Servo:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Brown/Black (GND) -> ",(0,l.jsx)(n.strong,{children:"GND"})]}),"\n",(0,l.jsxs)(n.li,{children:["Red (V+) -> ",(0,l.jsx)(n.strong,{children:"3V3"})]}),"\n",(0,l.jsxs)(n.li,{children:["Orange/Yellow (signal) -> ",(0,l.jsx)(n.strong,{children:"GP3"})," (you can choose another PWM-capable pin)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Ultrasonic Distance Sensor:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["TRIG -> ",(0,l.jsx)(n.strong,{children:"GP4"})]}),"\n",(0,l.jsxs)(n.li,{children:["ECHO -> ",(0,l.jsx)(n.strong,{children:"GP5"})]}),"\n",(0,l.jsxs)(n.li,{children:["VCC -> ",(0,l.jsx)(n.strong,{children:"3V3"})]}),"\n",(0,l.jsxs)(n.li,{children:["GND -> ",(0,l.jsx)(n.strong,{children:"GND"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"part-1---pico-w-firmware-http-api",children:"Part 1 - Pico W Firmware (HTTP API)"}),"\n",(0,l.jsx)(n.h3,{id:"11-servo-helper",children:"1.1 Servo helper"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"servo",src:s(9339).A+"",width:"1280",height:"809"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from machine import Pin, PWM\r\n\r\nclass Servo:\r\n    def __init__(self, pin=3, min_us=500, max_us=2500, freq=50):\r\n        self.pwm = PWM(Pin(pin))\r\n        self.pwm.freq(freq)\r\n        self.min_us = min_us\r\n        self.max_us = max_us\r\n        self.us_range = max_us - min_us\r\n\r\n    def angle(self, deg):\r\n        deg = max(0, min(180, int(deg)))\r\n        us = self.min_us + self.us_range * deg // 180\r\n        # duty_u16 for RP2040: duty = us / period * 65535\r\n        period_us = 1_000_000 // self.pwm.freq()   # 20,000 us at 50 Hz\r\n        duty = int(us * 65535 // period_us)\r\n        self.pwm.duty_u16(duty)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"12-ultrasonic-distance-helper",children:"1.2 Ultrasonic distance helper"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"ultrasonic",src:s(3497).A+"",width:"1311",height:"875"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from machine import Pin, time_pulse_us\r\nimport time\r\n\r\nclass Ultrasonic:\r\n    def __init__(self, trig_pin=4, echo_pin=5, timeout_us=30000):\r\n        self.trig = Pin(trig_pin, Pin.OUT)\r\n        self.echo = Pin(echo_pin, Pin.IN)\r\n        self.timeout_us = timeout_us\r\n        self.trig.value(0)\r\n        time.sleep_ms(50)\r\n\r\n    def measure_cm(self):\r\n        # 10 us trigger pulse\r\n        self.trig.value(0)\r\n        time.sleep_us(2)\r\n        self.trig.value(1)\r\n        time.sleep_us(10)\r\n        self.trig.value(0)\r\n\r\n        # measure echo high pulse (us); -2/-1 indicate timeout\r\n        t = time_pulse_us(self.echo, 1, self.timeout_us)\r\n        if t < 0:\r\n            return None\r\n        # distance = speed of sound * time / 2\r\n        return 343 * t * 1e-4 / 2\n"})}),"\n",(0,l.jsx)(n.h3,{id:"13-http-server",children:"1.3 HTTP server"}),"\n",(0,l.jsx)(n.p,{children:"Using the helpers and what you learned last lesson, write a HTTP server for controlling the servo and getting distance data."}),"\n",(0,l.jsx)(n.h2,{id:"part-2---build-the-mit-app-inventor-app",children:"Part 2 - Build the MIT App Inventor App"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"appinventor",src:s(1338).A+"",width:"1227",height:"825"})}),"\n",(0,l.jsx)(n.h3,{id:"21-designer-ui-components",children:"2.1 Designer (UI components)"}),"\n",(0,l.jsxs)(n.p,{children:["Open ",(0,l.jsx)(n.a,{href:"https://appinventor.mit.edu",children:"appinventor.mit.edu"})," -> ",(0,l.jsx)(n.strong,{children:"Create Apps"})," -> new project."]}),"\n",(0,l.jsx)(n.p,{children:"Add these components:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"User Interface"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Label"}),' (Title: Moving Radar")']}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"TextBox"})," (Hint: ",(0,l.jsx)(n.code,{children:"Pico IP"}),", ",(0,l.jsx)(n.code,{children:"Text"})," default your Pico IP, e.g. ",(0,l.jsx)(n.code,{children:"192.168.1.50"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Slider"})," (",(0,l.jsx)(n.code,{children:"Min=0"}),", ",(0,l.jsx)(n.code,{children:"Max=180"}),", ",(0,l.jsx)(n.code,{children:"ThumbPosition=90"}),") -> for angle"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Label"})," (Name: ",(0,l.jsx)(n.code,{children:"LabelAngle"}),", Text: ",(0,l.jsx)(n.code,{children:"Angle: 90"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Button"})," (",(0,l.jsx)(n.code,{children:'Text="Set Angle"'}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Button"})," (",(0,l.jsx)(n.code,{children:'Text="Scan"'}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Label"})," (Name: ",(0,l.jsx)(n.code,{children:"LabelDistance"}),", Text: ",(0,l.jsx)(n.code,{children:"Distance: -- cm"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Canvas"})," (",(0,l.jsx)(n.code,{children:"Width=Fill parent"}),", ",(0,l.jsx)(n.code,{children:"Height=200"}),") -> simple chart area"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Connectivity"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Web"})," (Name: ",(0,l.jsx)(n.code,{children:"Web1"}),")"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Sensors (optional)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Clock"})," (",(0,l.jsx)(n.code,{children:"TimerInterval=500"}),", ",(0,l.jsx)(n.code,{children:"Enabled=true"}),") -> poll distance every 0.5s"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["Optional: use the built-in ",(0,l.jsx)(n.strong,{children:"Charts"}),' component (Category "Experimental") instead of Canvas if available to you. Below we\'ll use Canvas for broad compatibility.']}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"22-blocks---configuration",children:"2.2 Blocks - Configuration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Create a helper block to build a base URL:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.strong,{children:"procedure"})," ",(0,l.jsx)(n.code,{children:"BaseURL"})," -> returns ",(0,l.jsx)(n.code,{children:'"http://" + TextBoxPicoIP.Text'})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"23-blocks---set-angle",children:"2.3 Blocks - Set angle"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Slider.PositionChanged"})," -> set ",(0,l.jsx)(n.code,{children:"LabelAngle.Text"})," to ",(0,l.jsx)(n.code,{children:'"Angle: " + round(position)'})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"ButtonSetAngle.Click"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'Web1.Url = BaseURL() + "/servo?angle=" + round(Slider.ThumbPosition)'})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"call Web1.Get"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"24-blocks---poll-distance-clock",children:"2.4 Blocks - Poll distance (Clock)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Clock.Timer"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'Web1.Url = BaseURL() + "/distance"'})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"call Web1.Get"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"25-blocks---handle-responses",children:"2.5 Blocks - Handle responses"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Web1.GotText"})," ",(0,l.jsx)(n.code,{children:"(url, responseCode, responseType, responseContent)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["If ",(0,l.jsx)(n.code,{children:"responseCode = 200"})," and ",(0,l.jsx)(n.code,{children:"responseType"})," contains ",(0,l.jsx)(n.code,{children:'"application/json"'}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"local obj = call JsonTextDecode(responseContent)"})}),"\n",(0,l.jsxs)(n.li,{children:["If URL contains ",(0,l.jsx)(n.code,{children:'"/distance"'}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'LabelDistance.Text = "Distance: " + round(obj["cm"]) + " cm"'})}),"\n",(0,l.jsx)(n.li,{children:"Plot this value on the Canvas (see next)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["If URL contains ",(0,l.jsx)(n.code,{children:'"/scan"'}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Clear Canvas, iterate ",(0,l.jsx)(n.code,{children:'obj["points"]'})," list, draw a polyline (angle on X, cm on Y)."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Optionally, if URL contains ",(0,l.jsx)(n.code,{children:'"/servo"'}),": update angle label."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"26-drawing-on-canvas-simple-chart",children:"2.6 Drawing on Canvas (simple chart)"}),"\n",(0,l.jsxs)(n.p,{children:["Create ",(0,l.jsx)(n.strong,{children:"procedures"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CanvasClear"}),": ",(0,l.jsx)(n.code,{children:"call Canvas.Clear"}),", draw axes:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"X axis: angle 0->180 mapped to canvas width"}),"\n",(0,l.jsx)(n.li,{children:"Y axis: 10->80 cm mapped to canvas height (invert y so 10 cm is near bottom or top as you prefer)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PlotPoint(angle, cm)"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"x = angle / 180 * Canvas.Width"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"y = map(cm, 10..80 -> Canvas.Height..0)"})," (linear map)"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"call Canvas.DrawCircle(x, y, 2)"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PlotPolylineFromList(points)"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["loop i=1..len-1: draw line from previous point to current ",(0,l.jsx)(n.code,{children:"(x1,y1) -> (x2,y2)"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Use these in:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Web1.GotText"})," when handling ",(0,l.jsx)(n.code,{children:"/distance"})," or ",(0,l.jsx)(n.code,{children:"/scan"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"ButtonScan.Click"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'Web1.Url = BaseURL() + "/scan?n=19"'})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"CanvasClear()"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Web1.Get"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"part-3---try-it",children:"Part 3 - Try It"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Flash the Pico code, note its ",(0,l.jsx)(n.strong,{children:"IP"})," in the REPL."]}),"\n",(0,l.jsx)(n.li,{children:"In App Inventor, connect the AI2 Companion on your Android phone."}),"\n",(0,l.jsxs)(n.li,{children:["Enter the Pico's IP in the ",(0,l.jsx)(n.code,{children:"TextBox"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Move the slider -> tap ",(0,l.jsx)(n.strong,{children:"Set Angle"})," -> servo should move."]}),"\n",(0,l.jsxs)(n.li,{children:["Watch ",(0,l.jsx)(n.strong,{children:"Distance"})," label update every ~0.5s."]}),"\n",(0,l.jsxs)(n.li,{children:["Tap ",(0,l.jsx)(n.strong,{children:"Scan"})," -> servo sweeps; a profile appears on the Canvas."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"exercise",children:"Exercise"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Turn the Pico into a remote music player, with a play/pause button on the phone."}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"optional-using-flask-as-a-relay-bonus",children:"Optional: Using Flask as a Relay (Bonus)"}),"\n",(0,l.jsxs)(n.p,{children:["If you built the previous Flask lesson, you can point the app to a ",(0,l.jsx)(n.strong,{children:"Flask relay"})," on your laptop, which then proxies to the Pico."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var i=s(6540);const l={},r=i.createContext(l);function c(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),i.createElement(r.Provider,{value:n},e.children)}},9339:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/servo-0ddc4eddd2dc907e6d06d747ac97445f.png"}}]);