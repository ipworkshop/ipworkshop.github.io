"use strict";(self.webpackChunkcourses=self.webpackChunkcourses||[]).push([[8911],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>d});var o=s(96540);const t={},i=o.createContext(t);function r(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(i.Provider,{value:n},e.children)}},57071:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"cloud_operations/kubernetes/resources/pods","title":"Pods","description":"","source":"@site/docs/cloud_operations/kubernetes/resources/pods.md","sourceDirName":"cloud_operations/kubernetes/resources","slug":"/cloud_operations/kubernetes/resources/pods","permalink":"/docs/cloud_operations/kubernetes/resources/pods","draft":false,"unlisted":false,"editUrl":"https://github.com/ipworkshop/ipworkshop.github.io/edit/main/docs/cloud_operations/kubernetes/resources/pods.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Pods","description":"","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Resources","permalink":"/docs/category/resources"},"next":{"title":"Pods","permalink":"/docs/category/pods"}}');var t=s(74848),i=s(28453);const r={title:"Pods",description:"",sidebar_position:1},d="Pods",a={},c=[{value:"Goals",id:"goals",level:2},{value:"Understanding Kubernetes Pods:",id:"understanding-kubernetes-pods",level:2},{value:"Basic Pod Example",id:"basic-pod-example",level:2},{value:"Explanation of the Pod Spec:",id:"explanation-of-the-pod-spec",level:2},{value:"Direct Pod Access",id:"direct-pod-access",level:2},{value:"Exercises:",id:"exercises",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",div:"div",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"pods",children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/",children:"Pods"})})}),"\n",(0,t.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Understand Kubernetes Pods"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Learn what a pod is and its role in the Kubernetes architecture."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Basic Example(s)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Provide (a) basic example(s) of Pods."}),"\n",(0,t.jsx)(n.li,{children:"Show how to define a Pod using YAML."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pod Spec Explanation"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Visit the Pod specification while following the example(s) above."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Direct Pod Access"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Describe how to create a direct network tunnel to a Pod for testing and/or debugging purposes."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Exercise"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Hands-on activity to create a simple Pod (using only the spec)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"understanding-kubernetes-pods",children:"Understanding Kubernetes Pods:"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"Pod"})," is the smallest, most basic deployable object in Kubernetes. It represents a single instance of a running process in your cluster. A pod encapsulates one or more containers, storage resources, a unique network IP, and options that govern how the containers should run."]}),"\n",(0,t.jsx)(n.h2,{id:"basic-pod-example",children:"Basic Pod Example"}),"\n",(0,t.jsx)(n.p,{children:"Here is a basic example of a Kubernetes pod specification in YAML:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod\nspec:\n  containers:\n  - name: nginx-container\n    image: nginx:1.21\n    ports:\n    - containerPort: 80\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Save this to a file ",(0,t.jsx)(n.code,{children:"pod.yaml"})," and create the resource using ",(0,t.jsx)(n.code,{children:"kubectl apply -f pod.yaml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"> kubectl apply -f pod.yaml\npod/nginx-pod created\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Next, let's take a look at the pods running in our cluster and see if we can find the newly created Pod using ",(0,t.jsx)(n.code,{children:"kubectl get pods"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"> kubectl get pods\nNAME                              READY   STATUS    RESTARTS        AGE\nnginx-pod                         1/1     Running   0               72s\n"})}),"\n",(0,t.jsx)(n.p,{children:"Let's explain this a little:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NAME"}),": As we can see on the left side we have the name of the Pod we've just created (remember the ",(0,t.jsx)(n.code,{children:"metadata.name"}),"?)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"READY"}),": To the right of it, we have the ",(0,t.jsx)(n.code,{children:"READY"})," section: ",(0,t.jsx)(n.code,{children:"1/1"})," means that ",(0,t.jsx)(n.code,{children:"1"})," out of ",(0,t.jsx)(n.code,{children:"1"})," Pods of this type are ready to serve traffic. But do we really need this? Well, yes, the maximum number of Pods, for any name, is ",(0,t.jsx)(n.code,{children:"1"}),", but what if our Pod is not ready? We should know that when retrieving Pods, so we can know that the reason we are having trouble with our app is cause the Pod is literally not in a ",(0,t.jsx)(n.code,{children:"Running"})," state. Usually, we won't launch just 1 Pod of this type, we'll be using a Set resource to help us deploy multiple and manage them, but then the ",(0,t.jsx)(n.code,{children:"metadata.name"})," provided will be the prefix for the final name of the pod (i.e ",(0,t.jsx)(n.code,{children:"nginx-pod-134af"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"STATUS"}),": Next, we have the ",(0,t.jsx)(n.code,{children:"STATUS"})," section, which lets us know what status our Pod is in ",(0,t.jsxs)(n.a,{href:"/docs/cloud_operations/kubernetes/resources/pod/pod-status",children:["(",(0,t.jsx)(n.code,{children:'"Pending" | "Running" | "Succeeded" | "Failed" | "Unknown"'}),")"]})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RESTARTS"}),": ",(0,t.jsx)(n.code,{children:"RESTARTS"})," show us how many times has the Pod restarted since it has been created, along with how much time has it passed since the last restart (if there has been any)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"AGE"}),": lastly, the ",(0,t.jsx)(n.code,{children:"AGE"}),", which shows us how old the Pod is"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["After creating the resource, we should also take a look at the state it is in, we can do this by making use of the ",(0,t.jsx)(n.code,{children:"kubectl describe pods/nginx-pod"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'> kubectl describe pods/nginx-pod\nName:             nginx-pod\nNamespace:        default\nPriority:         0\nService Account:  default\nNode:             minikube/192.168.49.2\nStart Time:       Mon, 05 Aug 2024 12:07:28 +0300\nLabels:           <none>\nAnnotations:      <none>\nStatus:           Running\nIP:               10.244.0.45\nIPs:\n  IP:  10.244.0.45\nContainers:\n  nginx-container:\n    Container ID:   docker://7b219a363f96823719c9f68f0e0e5106007808c6d4b840d1521ab1383606e99b\n    Image:          nginx:1.21\n    Image ID:       docker-pullable://nginx@sha256:2bcabc23b45489fb0885d69a06ba1d648aeda973fae7bb981bafbb884165e514\n    Port:           80/TCP\n    Host Port:      0/TCP\n    State:          Running\n      Started:      Mon, 05 Aug 2024 12:07:39 +0300\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-kwl7s (ro)\nConditions:\n  Type                        Status\n  PodReadyToStartContainers   True\n  Initialized                 True\n  Ready                       True\n  ContainersReady             True\n  PodScheduled                True\nVolumes:\n  kube-api-access-kwl7s:\n    Type:                    Projected (a volume that contains injected data from multiple sources)\n    TokenExpirationSeconds:  3607\n    ConfigMapName:           kube-root-ca.crt\n    ConfigMapOptional:       <nil>\n    DownwardAPI:             true\nQoS Class:                   BestEffort\nNode-Selectors:              <none>\nTolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\nEvents:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  25m   default-scheduler  Successfully assigned default/nginx-pod to minikube\n  Normal  Pulling    25m   kubelet            Pulling image "nginx:1.21"\n  Normal  Pulled     25m   kubelet            Successfully pulled image "nginx:1.21" in 9.687s (9.687s including waiting). Image size: 141526528 bytes.\n  Normal  Created    25m   kubelet            Created container nginx-container\n  Normal  Started    25m   kubelet            Started container nginx-container\n'})}),"\n",(0,t.jsxs)(n.p,{children:["A lot of information, I know, but bare with me, we can digest most of it, but we don't even need to.\nThe ",(0,t.jsx)(n.code,{children:"describe"})," function, though, lets us see exactly why stuff went wrong, went it did, well that's what it's mostly used for, or making sure nothing did, in fact, went wrong, so we can go in search of the real culprit that is giving us headaches."]}),"\n",(0,t.jsx)(n.p,{children:"What is of most interest are the next things:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"containers' ports"}),"\n",(0,t.jsx)(n.li,{children:"containers' ready state"}),"\n",(0,t.jsx)(n.li,{children:"conditions"}),"\n",(0,t.jsx)(n.li,{children:"events"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If we know these things, we can see pretty quick (at least for our use cases) if the Pod is set up properly. While most of the data is pretty self explanatory, emphasis should be put on the ",(0,t.jsx)(n.code,{children:"Events"})," section, which gives us a detailed trace of each step that happened. If a problem did happen, you'd be pretty sure it is found here."]}),"\n",(0,t.jsxs)(n.h2,{id:"explanation-of-the-pod-spec",children:["Explanation of the ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/",children:"Pod Spec"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"apiVersion: v1 (hardcoded)"}),"\n",(0,t.jsx)(n.li,{children:"kind: Pod (type of resource)"}),"\n",(0,t.jsxs)(n.li,{children:["metadata: ",(0,t.jsx)(n.a,{href:"/docs/cloud_operations/kubernetes/resources/object-meta",children:"ObjectMeta"})]}),"\n",(0,t.jsxs)(n.li,{children:["spec: ",(0,t.jsx)(n.a,{href:"/docs/cloud_operations/kubernetes/resources/pod/pod-spec",children:"PodSpec"})]}),"\n",(0,t.jsxs)(n.li,{children:["status: ",(0,t.jsx)(n.a,{href:"/docs/cloud_operations/kubernetes/resources/pod/pod-status",children:"PodStatus"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"direct-pod-access",children:"Direct Pod Access"}),"\n",(0,t.jsx)(n.p,{children:"Great, we've deployed our first resource, a Pod! But what can we do with it? Can we access it? Well, usually, you'd want to put it behind a Service (so that it can be accessed from a hostname), that would also be behind an Ingress (so that outside traffic can enter the cluster)."}),"\n",(0,t.jsx)(n.p,{children:"Since we haven't done any of those, we'll create a direct tunnel to the Pod:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"> kubectl port-forward nginx-pod 8000:80\nForwarding from 127.0.0.1:8000 -> 80\nForwarding from [::1]:8000 -> 80\n"})}),"\n",(0,t.jsxs)(n.p,{children:["With this simple command (don't close the terminal!!!), our machine's port ",(0,t.jsx)(n.code,{children:"8000"})," is made so it proxies traffic to the port ",(0,t.jsx)(n.code,{children:"80"})," of our container"]}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.p,{children:"If you are using WSL2, the things aren't that simple. WSL2 has a different network interface than Windows, which means you need to start your browser from WSL2 (usually install it in WSL2 again, cause it's basically another operating system) or forward traffic from Windows to WSL2."})}),"\n",(0,t.jsxs)(n.p,{children:["Now to test it and make sure it works, we can do a simple ",(0,t.jsx)(n.code,{children:"curl http://localhost:8000"})," command in the terminal:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'> curl http://localhost:8000\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href="http://nginx.org/">nginx.org</a>.<br/>\nCommercial support is available at\n<a href="http://nginx.com/">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n'})}),"\n",(0,t.jsx)(n.p,{children:"And just like that we got to have our first Pod, create a tunnel to it and see that it works!"}),"\n",(0,t.jsx)(n.h2,{id:"exercises",children:"Exercises:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Write a YAML file named ",(0,t.jsx)(n.code,{children:"multi-container-pod.yaml"})," that defines a Pod having 2 containers: a container named ",(0,t.jsx)(n.code,{children:"nginx-container"}),", but on port ",(0,t.jsx)(n.code,{children:"3000"}),", that is the same as the one provided in the example, and another container named ",(0,t.jsx)(n.code,{children:"busybox-container"})," that uses the ",(0,t.jsx)(n.code,{children:"busybox"})," image and that provides it the next command: `/bin/sh -c echo BusyBox Hello! && sleep 3600'"]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["It is usually recommended to split commands into multiple parts as follows: first being the exectuable run (in our case ",(0,t.jsx)(n.code,{children:"/bin/sh"}),") and aftewards each argument by itself (",(0,t.jsx)(n.code,{children:"-c"}),", ",(0,t.jsx)(n.code,{children:"echo BusyBox Hello! && sleep 3600"}),")."]}),(0,t.jsxs)(n.p,{children:["So in the end it looks like: ",(0,t.jsx)(n.code,{children:"['/bin/sh', '-c', 'echo BusyBox Hello! && sleep 3600']"})," when you pass it to the container"]})]}),"\n",(0,t.jsxs)(n.p,{children:["Create the resource using ",(0,t.jsx)(n.code,{children:"kubectl apply"}),", create a tunnel to send a request and make sure it works when you request the webpage, and also check the logs of the Pod using the ",(0,t.jsx)(n.code,{children:"kubectl logs"})," command"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Write a YAML file named ",(0,t.jsx)(n.code,{children:"resource-limited-pod.yaml"})," to define a pod with one container, ",(0,t.jsx)(n.code,{children:"resource-limited-container"}),", using the ",(0,t.jsx)(n.code,{children:"busybox"})," image, the ",(0,t.jsx)(n.code,{children:"['/bin/sh', '-c', 'while true; do echo Hello Kubernetes!; sleep 5; done']"})," command and with the next resources:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Resource requests:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["CPU: ",(0,t.jsx)(n.code,{children:"100m"})]}),"\n",(0,t.jsxs)(n.li,{children:["Memory: ",(0,t.jsx)(n.code,{children:"64Mi"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Resource limits:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["CPU: ",(0,t.jsx)(n.code,{children:"200m"})]}),"\n",(0,t.jsxs)(n.li,{children:["Memory: ",(0,t.jsx)(n.code,{children:"128Mi"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Create the Pod and monitor its usage using the ",(0,t.jsx)(n.code,{children:"kubectl top"})," command"]}),"\n",(0,t.jsxs)(n.p,{children:["Try running a resource-intensive command ",(0,t.jsx)(n.code,{children:"yes > /dev/null"})," and observe the behavior of the Pod under resource limits"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["When using minikube, make sure you enable the ",(0,t.jsx)(n.code,{children:"metrics-server"}),": ",(0,t.jsx)(n.code,{children:"> minikube addons enable metrics-server"})]})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["To run commands inside Pods, you can make use of the ",(0,t.jsx)(n.code,{children:"kubectl exec"})," command as follows:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'> kubectl exec -it __POD_NAME__ -- /bin/sh -c "echo Hello"\n'})})]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);